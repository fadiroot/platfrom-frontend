"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5955],{31349:function(e,t,n){var o=n(52676),i=n(75271),r=n(46974),l=n(61271),a=n(77742),s=n(35019),c=n(62935),d=n(57598),u=n(65893),p=n(97348),h=n(48122),g=n(62205),m=n(2656),x=n(21461),f=n(71137),v=n(44754),b=n(98570),j=n(63888),Z=n(10986),y=n(94146),w=n(32757),C=n(11075),k=n(36412),I=n(11555),_=n(81138),S=n(79267),z=n(44941),R=n(45137),T=n(28337);t.Z=e=>{let{open:t,onClose:n,setPrompt:P,showCreateButton:F=!0}=e,G=(0,r.useRouter)(),{enqueueSnackbar:U}=(0,Z.Ds)(),D=(0,z.Z)("up","md"),{mutate:W,isLoading:E}=(0,_.AY)(),{status:N}=(0,j.useSession)(),O="authenticated"===N,[A,L]=(0,i.useState)(!1),[B,M]=(0,i.useState)(),[$,q]=(0,i.useState)("gpt-4o-mini"),[Y,H]=(0,i.useState)(""),J=`${I.M5}${I.Ay}?prompt=${encodeURIComponent(Y)}`,[V,K]=(0,i.useState)(!1),Q=(0,i.useRef)(null),X=(0,i.useRef)(!1),ee=()=>{n()};(0,i.useEffect)(()=>{X.current=!1,K(!1)},[]);let et=async e=>{if(!O)return G.push("/signin");if(e){K(!1),M({file:e});let t=new FormData;t.append("file",e),L(!0),await T.ZP.post("/media/upload_image",t,{headers:{"Content-Type":"multipart/form-data"}}).then(async e=>{if(200===e.status&&e.data){let{imageUrl:t}=e.data;en(t,!0)}}).finally(()=>{L(!1)})}else M(void 0)},en=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];W({image:e,is_tmp_image:t,model:$},{onSuccess:e=>{var t;(null==e?void 0:null===(t=e.caption)||void 0===t?void 0:t.length)>0&&!X.current&&(H(e.caption),R.B("asset_created",{creation_source:"app",app_name:"image_to_text",image_num:1}))}})},{UploadContextMenu:eo,handleMenuOpen:ei}=(0,k.w)({onChange:e=>{if(e&&e.length>0){let t=e[0];M({preview:t}),L(!0),en(t),L(!1)}},onClickUpload:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.triggerInputClick()},maxSelectionCount:1});(0,b.Z)(()=>{(null==B?void 0:B.file)&&et(B.file)},[$]);let er=E||!Y;return(0,o.jsxs)(l.Z,{open:t,fullWidth:!0,maxWidth:"md",scroll:"paper",onClose:ee,children:[(0,o.jsx)(a.Z,{mb:1,children:(0,o.jsx)(s.Z,{direction:"column",children:(0,o.jsx)(c.Z,{variant:"h4",children:"Image to Prompt"})})}),(0,o.jsxs)(d.Z,{sx:{width:"100%"},children:[!O&&(0,o.jsxs)(s.Z,{direction:"column",alignItems:"center",justifyContent:"center",spacing:1,sx:{my:2},children:[(0,o.jsx)(C.Z,{title:"Sign Up"}),(0,o.jsx)(c.Z,{variant:"caption",fontWeight:"bold",children:"⚠️ You need to sign up to use this feature."})]}),(0,o.jsxs)(s.Z,{direction:D?"row":"column",sx:{width:"100%"},spacing:2,children:[(0,o.jsxs)(s.Z,{direction:"column",alignItems:"center",justifyContent:"center",children:[(0,o.jsx)(u.Z,{sx:{cursor:"pointer"},children:(0,o.jsx)(w.Z,{ref:Q,isUploading:A,file:B,bordered:!1,title:"Drag and drop, upload, or select from history",sx:{borderRadius:0,margin:0,width:D?"300px":"250px",height:D?"300px":"250px"},dropZoneSx:{borderRadius:0},onDrop:e=>{e&&e.length>0&&et(e[0])},onDelete:()=>{et(null)},onAreaClick:e=>{if(!O)return G.push("/signin");e.preventDefault(),ei(e)},zoomable:!0,deletable:!0})}),eo,(0,o.jsxs)(p.Z,{sx:{mx:1,mt:1},size:"small",children:[(0,o.jsx)(h.Z,{id:"model-select-label",children:"Model"}),(0,o.jsxs)(g.Z,{disabled:E,labelId:"model-select-label",id:"model-select",value:$,size:"small",label:"Model",sx:{minWidth:"280px"},onChange:e=>{q(e.target.value)},children:[(0,o.jsx)(m.Z,{value:"gpt-4o-mini",children:(0,o.jsx)(c.Z,{variant:"body2",children:"GPT-4o-mini"})}),(0,o.jsx)(m.Z,{value:"florence",children:(0,o.jsx)(c.Z,{variant:"body2",children:"Florence"})})]})]})]}),(0,o.jsxs)(s.Z,{direction:"column",sx:{width:"100%"},spacing:2,children:[(0,o.jsx)(u.Z,{children:(0,o.jsx)(x.Z,{sx:{mt:1},label:E&&!V?"Generating prompt...":"",fullWidth:!0,disabled:E?!V:null,variant:"outlined",multiline:!0,minRows:D?10:3,placeholder:"Upload an image to generate a text prompt",value:Y,onChange:e=>H(e.target.value),inputProps:{maxLength:1024},helperText:(0,o.jsxs)(c.Z,{variant:"caption",component:"span",textAlign:"right",sx:{width:"100%",display:"inline-block"},children:[Y.length," / 1024"]})})}),(0,o.jsxs)(s.Z,{direction:"row",children:[(0,o.jsx)(f.Z,{variant:"contained",disabled:er,className:"oa-button-primary",onClick:()=>{P?(P(Y),ee()):(U("Prompt has been copied!",{variant:"success"}),navigator.clipboard.writeText(Y))},startIcon:E?(0,o.jsx)(v.Z,{size:18}):(0,o.jsx)(S.A2h,{size:18,sx:{color:er?"disabled":"#FBFBFD"}}),"aria-label":"Copy prompt",sx:{flex:1,mr:1},children:E?"Generating prompt...":P?"Use Prompt":"Copy Prompt"}),F?(0,o.jsx)(y.Z,{disabled:er,href:J,openInNewTab:!0}):null]})]})]}),(0,o.jsx)(s.Z,{direction:"row",sx:{mt:4},children:(0,o.jsx)(f.Z,{variant:"text",onClick:ee,sx:{width:"100%"},children:"Close"})})]})]})}},32757:function(e,t,n){var o=n(52676),i=n(75271),r=n(3170),l=n(86180),a=n(50272),s=n(43682),c=n(65893),d=n(62935),u=n(44754),p=n(71137),h=n(12073),g=n(25110),m=n(84625),x=n(93001),f=n(79267),v=n(31526);let b="upload-image-button",j=(0,i.forwardRef)((e,t)=>{let{error:n,file:j,isUploading:Z,caption:y,sx:w,dropZoneSx:C,bordered:k,title:I="Click or drag a photo to upload",zoomable:_,deletable:S,onDelete:z,onDrop:R,onChange:T,multiple:P,disabled:F=!1,accept:G,showIcon:U=!0,buttonVariant:D,onAreaClick:W,maxFiles:E,fallbackWhenNoFile:N,...O}=e,A=(0,h.Z)(),{getRootProps:L,getInputProps:B,isDragActive:M,isDragReject:$,fileRejections:q,inputRef:Y}=(0,m.uI)({multiple:P,maxFiles:E,accept:G??{"image/png":[],"image/jpeg":[],"image/webp":[],"image/gif":[],"image/svg+xml":[],"image/apng":[],"image/avif":[],"image/bmp":[]},onDrop:e=>{e.length>0?null==T||T(P?e:e[0]):null==T||T(null),null==R||R(e)},disabled:F,noClick:!!W,...O}),H=L(),J=()=>{Y.current&&Y.current.click()};(0,i.useImperativeHandle)(t,()=>({triggerInputClick:J}));let[V,K]=(0,i.useState)(!1),Q=e=>{K(e)},X=e=>{if(!W)return;let t=e.target,n=!1;for(;t&&t!==e.currentTarget;){if(t.classList.contains(b)){n=!0;break}t=t.parentElement}n||W(e)},ee=j&&(j.preview||(j.file?URL.createObjectURL(j.file):"")),et={display:"flex",position:"absolute",alignItems:"center",flexDirection:"column",justifyContent:"center",color:A.palette.text.secondary,backgroundColor:D?null:A.palette.background.neutral,transition:A.transitions.create("opacity",{duration:A.transitions.duration.shorter}),overflow:"auto",msOverflowStyle:"none",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},"&:hover":{opacity:D&&!j?1:.72},...j&&{opacity:0,color:"common.white",bgcolor:"grey.900","&:hover":{opacity:.72}}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(c.Z,{sx:(0,v.j)({width:144,height:144,margin:"auto",borderRadius:"50%",padding:A.spacing(1),position:"relative",border:!1===k?"none":`1px dashed ${A.palette.grey[50032]}`,scrollbarWidth:"none !important"},w),children:[Z?(0,o.jsx)(c.Z,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",zIndex:9999,color:"white"},children:(0,o.jsx)(u.Z,{})}):null,(0,o.jsxs)(c.Z,{...H,onClick:W?X:H.onClick,onContextMenu:W?X:void 0,sx:{zIndex:0,width:"100%",height:"100%",outline:"none",display:"flex",overflow:"hidden",borderRadius:"50%",position:"relative",alignItems:"center",justifyContent:"center","&::-webkit-scrollbar":{display:"none !important"},"&":{msOverflowStyle:"none !important",scrollbarWidth:"none !important"},[`& > *:not(.${b})`]:{width:"100%",height:"100%"},"&:hover":{cursor:"pointer","& .placeholder":{zIndex:9}},...M&&{opacity:.72},...($||n)&&{color:"error.main",borderColor:"error.light",bgcolor:"error.lighter"},...C},children:[(0,o.jsx)("input",{...B()}),ee?_?(0,o.jsx)(c.Z,{onClick:e=>e.stopPropagation(),sx:{"&>div, &>div>div, & img":{height:"100%",width:"100%"}},children:(0,o.jsx)(x.f,{zoomMargin:20,isZoomed:V,onZoomChange:Q,children:(0,o.jsx)(c.Z,{component:"img",alt:"avatar",src:ee,sx:{zIndex:8,objectFit:"contain"}})})}):(0,o.jsx)(c.Z,{component:"img",alt:"avatar",src:ee,sx:{zIndex:8,objectFit:"cover"}}):N??null,(0,o.jsx)(c.Z,{className:"placeholder",sx:et,children:D?(0,o.jsxs)(p.Z,{variant:"outlined",sx:{position:"absolute",height:"30px !important",width:"fit-content !important",display:"flex",gap:.5,backgroundColor:"#292929",borderColor:"#444444",textTransform:"none",fontSize:12,px:1,color:"white","&:hover":{backgroundColor:"#ffffff3d",borderColor:"#ffffff3d"}},disabled:F,children:[(0,o.jsx)(r.Z,{}),"Click or drag to upload"]}):(0,o.jsxs)(o.Fragment,{children:[U?(0,o.jsx)(f.JGh,{size:{xs:32,md:24},sx:{mb:1}}):null,(0,o.jsx)(d.Z,{variant:"caption",textAlign:"center",children:I||"Click or drag a photo to upload"})]})}),j&&_?(0,o.jsx)(c.Z,{className:b,sx:{position:"absolute",top:4,right:4,zIndex:1e3,background:"rgba(0,0,0,0.5)",width:30,height:30,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:1},onClick:e=>{e.stopPropagation(),Q(!0)},children:(0,o.jsx)(a.Z,{})}):null,j&&S?(0,o.jsx)(c.Z,{className:b,sx:{position:"absolute",top:4,right:40,zIndex:1e3,background:"rgba(0,0,0,0.5)",width:30,height:30,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:1},onClick:e=>{e.stopPropagation(),null==z||z(),null==T||T(null)},children:(0,o.jsx)(l.Z,{})}):null]})]}),y,q.length>0&&(0,o.jsx)(s.Z,{variant:"outlined",sx:{py:1,px:2,my:2,borderColor:"error.light",bgcolor:e=>(0,g.Fq)(e.palette.error.main,.08)},children:q.map(e=>{let{file:t,errors:n}=e,{name:i}=t;return(0,o.jsxs)(c.Z,{sx:{my:1},children:[(0,o.jsx)(d.Z,{variant:"subtitle2",noWrap:!0,children:i}),n.map(e=>(0,o.jsxs)(d.Z,{variant:"caption",component:"p",children:["- ",e.message]},e.code))]},i)})})]})});j.displayName="UploadAvatar",t.Z=j},70437:function(e,t,n){n.d(t,{p:function(){return c}});var o=n(75271),i=n(63888),r=n(45137);let l=!1,a=null,s="756138352495-gupihil7j78jagu6mps2vv2g185t1ai4.apps.googleusercontent.com";function c(e){let{status:t}=(0,i.useSession)(),n="authenticated"===t,{onSuccess:c,onError:d,...u}=e||{},[p,h]=(0,o.useState)(!1),[g,m]=(0,o.useState)(!1),x=(0,o.useRef)(),f=(0,o.useCallback)(async e=>{try{h(!0),r.B("sign_in_started",{type:"sign_in",sign_in_method:"google_one_tap",callback_url:u.callbackUrl||""});let t=await (0,i.signIn)("googleonetap",{credential:e.credential,...u});if(u.redirect||(null==t?void 0:t.ok))null==c||c();else{let e=(null==t?void 0:t.error)||"Google One Tap signin failed";console.error("Google One Tap signin error with result:",t,e),null==d||d(e)}}catch(e){console.error("Google One Tap signin error:",e),null==d||d(e)}finally{h(!1)}},[u,c,d]);return x.current=f,(0,o.useEffect)(()=>{let e=()=>{var e,t;return null!==(t=window.google)&&void 0!==t&&null!==(e=t.accounts)&&void 0!==e&&!!e.id&&(m(!0),!0)};if(e())return;let t=setInterval(()=>{e()&&clearInterval(t)},100);return()=>clearInterval(t)},[]),(0,o.useEffect)(()=>{g&&s&&!n&&!p&&(async()=>l||a?a:a=new Promise(e=>{try{var t;let{google:n}=window;if(!(null==n?void 0:null===(t=n.accounts)||void 0===t?void 0:t.id)){console.warn("Google One Tap: Google accounts script not available"),e();return}try{n.accounts.id.cancel()}catch{}n.accounts.id.initialize({client_id:s,color_scheme:"dark",use_fedcm_for_prompt:!0,use_fedcm_for_button:!0,callback:e=>{var t;null===(t=x.current)||void 0===t||t.call(x,e)}}),l=!0,n.accounts.id.prompt(e=>{}),e()}catch(t){console.error("Google One Tap initialization error:",t),e()}}))()},[g,n,p]),{isLoading:p,isScriptReady:g}}},2638:function(e,t,n){n.d(t,{b:function(){return o},k:function(){return i}});let o=async(e,t)=>{let n=document.querySelector(e);if(n)return new Promise(e=>{let o=null;setTimeout(function t(){let i=n.getBoundingClientRect().top;i===o?e(null):(o=i,setTimeout(t,100))},100),n.scrollIntoView({behavior:"smooth",block:t??"nearest"})})},i=e=>{let t=document.querySelector(e);if(t)return new Promise(e=>{t.scrollTo({top:0,behavior:"smooth"}),t.addEventListener("scroll",function n(){0===t.scrollTop&&(t.removeEventListener("scroll",n),e(null))})})}}}]);