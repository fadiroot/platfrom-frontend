"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6405],{46405:function(e,i,t){t.d(i,{v:function(){return Z}});var s=t(52676),a=t(75271),l=t(78657),r=t(58684),n=t(61271),o=t(66686),c=t(57598),d=t(35019),p=t(65893),u=t(44754),m=t(62935),h=t(48945),x=t(21461),f=t(22289),g=t(433),b=t(30754),v=t(42232);let w=e=>e?/^[^\s@]+@[^\s@][^\s.@]*\.[^\s@]+$/.test(e)?{email:e,isValid:!0,pending:!0}:{email:e,isValid:!1,errorMessage:"Invalid email format"}:{email:e,isValid:!1,errorMessage:"Email cannot be empty"},y=e=>e.split(/[,;\s]+/).map(e=>e.trim().toLowerCase()).filter(Boolean),j=e=>[...new Set(e.map(e=>e.toLowerCase()))];function Z(e){let{onClose:i,memberNumber:t,sessionId:Z,showInvite:k=!1,isTeamFirstCreated:E=!0,...F}=e,[I,C]=(0,a.useState)([]),[S,V]=(0,a.useState)(""),[_,W]=(0,a.useState)(!1),[z,D]=(0,g.dY)(),[M]=(0,g.vE)(),[R,P,A]=(0,g.fj)(Z),[B]=(0,f.tL)(),L=(0,a.useRef)(!0),T=(0,a.useRef)(null),[N,O]=(0,a.useState)(k),[Y,$]=(0,a.useState)(""),[U,G]=(0,a.useState)(!1),[K,q]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=new URLSearchParams(window.location.search),i=e.get("success"),t=e.get("show_invite");if("subscription_purchased"===i&&null!==t){O(!0);let e=window.location.pathname;window.history.replaceState({},document.title,e)}},[]);let H=(0,a.useCallback)(()=>{Z&&L.current&&A.refetch()},[Z,A]);(0,a.useEffect)(()=>{Z&&R&&R.team_id&&R.virtual_user_profile_id&&(L.current=!1,T.current&&(clearInterval(T.current),T.current=null),B({workspace_user_id:R.virtual_user_profile_id,workspace_team_id:R.team_id}).then(()=>{window.location.href=`subscriptions?success=subscription_purchased&tier=4000&show_invite=true&quantity=${t}`}))},[Z,R,B,N,t]),(0,a.useEffect)(()=>{if(Z)return L.current&&(H(),T.current=setInterval(()=>{H()},2e3)),()=>{T.current&&(clearInterval(T.current),T.current=null)}},[Z,H]);let J=async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ee())},Q=async e=>{let i=e.map(e=>e.email),t=await z({emails:i});return e.map(e=>{let i=t.find(i=>i.email===e.email);return i?{...e,isValid:i.isValid,errorMessage:i.isValid?void 0:i.errorReason||"Invalid email",pending:!1}:e})},X=e=>e.map(e=>e.pending?{...e,isValid:!1,errorMessage:"Error checking email. Please try again.",pending:!1}:e),ee=async()=>{let e=S.trim();if(!e)return{success:!0,hasValidEmails:!1,processedEmails:I};try{let i=y(e),t=j(i).map(w),s=new Set(I.map(e=>e.email.toLowerCase())),a=t.filter(e=>!s.has(e.email.toLowerCase()));if(0===a.length)return{success:!0,hasValidEmails:I.some(e=>e.isValid),processedEmails:I};let l=a.filter(e=>e.isValid),r=a.filter(e=>!e.isValid),n=[...I,...a];if(C(n),V(""),0===l.length)return{success:0===r.length,hasValidEmails:n.some(e=>e.isValid),processedEmails:n};try{let e=await Q(l),i=[...I.filter(e=>!l.some(i=>i.email===e.email)),...r,...e];C(i);let t=e.every(e=>e.isValid),s=i.some(e=>e.isValid);return{success:t,hasValidEmails:s,processedEmails:i}}catch{let e=X(l),i=[...I.filter(e=>!l.some(i=>i.email===e.email)),...r,...e];return C(i),{success:!1,hasValidEmails:i.some(e=>e.isValid),processedEmails:i}}}catch(e){return console.error("Email validation error:",e),{success:!1,hasValidEmails:I.some(e=>e.isValid),processedEmails:I}}},ei=e=>{C(I.filter(i=>i.email!==e))},et=I.filter(e=>e.isValid).length>0,es=I.length>t,ea=D||_||!et&&!S.trim()||es,el=async e=>{try{W(!0);let e=[...I],s=e.some(e=>e.isValid);if(S.trim()){let i=await ee();s=i.hasValidEmails,e=i.processedEmails}let a=e.filter(e=>e.isValid).length>t;if(s&&!a){let t=JSON.parse(sessionStorage.getItem("lastUsedWorkspace")||"{}"),s={team_id:null==t?void 0:t.workspace_team_id,emails:e.filter(e=>e.isValid).map(e=>e.email)},a=await M(s);a.success?(0,b.t5)("Invite sent successfully!"):(0,b.cB)(a.error),null==i||i()}}catch{W(!1)}finally{W(!1)}},[er,en,{failureReason:eo}]=(0,g.ip)({enabled:N&&!U});(0,a.useEffect)(()=>{if(eo){var e,i;G(!0),q((null==eo?void 0:null===(i=eo.response)||void 0===i?void 0:null===(e=i.data)||void 0===e?void 0:e.error)||"")}},[eo]),(0,a.useEffect)(()=>{er&&$(er.invite_link)},[er]);let ec=(0,a.useCallback)(async()=>{if(Y)try{await navigator.clipboard.writeText(Y),(0,b.t5)("Invite link copied to clipboard!")}catch(e){console.error("Failed to copy to clipboard:",e),(0,b.cB)("Failed to copy link to clipboard")}},[Y]);return(0,s.jsxs)(n.Z,{...F,maxWidth:!1,fullWidth:!0,"aria-labelledby":"add-seats-dialog-title",onClose:(e,t)=>{("backdropClick"!==t||N)&&i&&i()},sx:{"& .MuiDialog-paper":{margin:0,maxWidth:{xs:"98%",sm:"1021px"},px:{xs:2,sm:28},py:{xs:2,sm:10},display:"flex",flexDirection:"column",alignItems:"center"}},children:[N?(0,s.jsx)(o.Z,{onClick:()=>{i&&i()},sx:{position:"absolute",right:16,top:16,color:"text.secondary"},children:(0,s.jsx)(l.default,{})}):null,(0,s.jsx)(c.Z,{sx:{p:0,width:"100%"},children:P||!N?(0,s.jsxs)(d.Z,{spacing:4,alignItems:"center",justifyContent:"center",height:"280px",children:[(0,s.jsx)(p.Z,{sx:{position:"relative",display:"inline-flex"},children:(0,s.jsx)(u.Z,{size:60,thickness:4,sx:{color:"primary.main",animation:"spin 1.5s linear infinite","@keyframes spin":{"0%":{color:"#3FDD78"},"33%":{color:"#5D9CEC"},"66%":{color:"#ED57A1"},"100%":{color:"#3FDD78"}}}})}),(0,s.jsxs)(d.Z,{spacing:1.5,alignItems:"center",textAlign:"center",children:[(0,s.jsx)(m.Z,{variant:"h4",fontWeight:700,sx:{color:"#FFFFFF"},children:"Setting up your team workspace..."}),(0,s.jsx)(m.Z,{fontSize:16,color:"text.secondary",children:"This may take a moment. Please be patient."}),(0,s.jsxs)(m.Z,{color:"warning.main",fontSize:15,fontWeight:500,sx:{mt:1.5,display:"flex",alignItems:"center",bgcolor:"rgba(255, 193, 7, 0.08)",px:2.5,py:1.5,borderRadius:1.5,border:"1px solid rgba(255, 193, 7, 0.2)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[(0,s.jsx)(v.Z,{icon:"mdi:alert-circle-outline",sx:{mr:1.5,fontSize:22,color:"#FFCF52"}}),"Please do not close this dialog or browser tab"]})]})]}):(0,s.jsxs)(d.Z,{spacing:4,width:"100%",children:[(0,s.jsx)(d.Z,{spacing:1,children:E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{fontSize:32,fontWeight:700,children:"Your Team Workspace is Created! \uD83C\uDF89"}),(0,s.jsxs)(m.Z,{fontSize:16,fontWeight:500,textAlign:"center",color:"#FFFFFFB2",children:["You have ",(0,s.jsxs)("span",{style:{color:"#3FDD78"},children:[t-1," available seats"]}),". Invite your teammates to start collaborating."]})]}):(0,s.jsx)(m.Z,{variant:"h4",fontWeight:700,children:"Invite Teammate"})}),(0,s.jsxs)(d.Z,{spacing:1,width:"100%",children:[(0,s.jsxs)(d.Z,{direction:"row",spacing:1,alignItems:"center",width:"100%",children:[(0,s.jsx)(v.Z,{icon:"mdi:email-outline",sx:{color:"white",fontSize:18}}),(0,s.jsx)(m.Z,{fontSize:16,fontWeight:500,children:"Invite via email"})]}),(0,s.jsxs)(d.Z,{spacing:1,width:"100%",direction:"column",sx:{backgroundColor:"#202020",px:1.5,py:1,borderRadius:.4},children:[I.length>0&&(0,s.jsx)(p.Z,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:.5,width:"100%"},role:"region","aria-label":"Email list",children:I.map(e=>(0,s.jsx)(h.Z,{label:(0,s.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center"},children:[e.pending?(0,s.jsx)(u.Z,{size:14,sx:{mr:1,color:"inherit"}}):null,e.email,e.isValid||e.pending?null:(0,s.jsxs)(m.Z,{variant:"caption",sx:{ml:.5,maxWidth:"none",color:"#FF4E4E"},children:["(",e.errorMessage,")"]})]}),size:"medium",onDelete:()=>ei(e.email),deleteIcon:(0,s.jsx)(v.Z,{icon:"mdi:close"}),sx:{border:e.isValid||e.pending?"none":"#832727",backgroundColor:e.isValid||e.pending?"none":"#FF2C2C12"}},e.email))}),(0,s.jsx)(x.Z,{placeholder:"Enter email addresses (separate with commas, spaces, or new lines)",value:S,onChange:e=>{V(e.target.value)},onKeyDown:J,variant:"standard",fullWidth:!0,multiline:!0,rows:4,"aria-label":"Email addresses input",error:es,helperText:es?`You've exceeded your team member limit. Current: ${I.length}, Maximum: ${t}`:"",sx:{"& .MuiInput-root":{"&:before, &:after":{display:"none"}},"& .MuiInputBase-input":{p:1},position:"relative"},InputProps:{disableUnderline:!0,"aria-describedby":"email-input-helper-text"},FormHelperTextProps:{id:"email-input-helper-text",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,mx:0,color:es?"error.main":"inherit"}}})]})]}),(0,s.jsx)(p.Z,{sx:{display:"flex",alignItems:"start",gap:2,mt:2},children:(0,s.jsx)(r.Z,{size:"medium",className:"oa-button-primary",loading:D||_,disabled:ea,variant:"contained",onClick:el,fullWidth:!0,children:"Send Invitation"})}),(0,s.jsxs)(d.Z,{spacing:1,width:"100%",children:[(0,s.jsx)(m.Z,{component:"div",sx:{width:"100%",textAlign:"center",my:2,color:"text.secondary",position:"relative","&::before, &::after":{content:'""',position:"absolute",top:"50%",width:"45%",height:"1px",backgroundColor:"rgba(255, 255, 255, 0.12)"},"&::before":{left:0},"&::after":{right:0}},children:"OR"}),(0,s.jsxs)(d.Z,{direction:"row",spacing:1,alignItems:"center",width:"100%",children:[(0,s.jsx)(v.Z,{icon:"mdi:link-variant",sx:{color:"white",fontSize:18}}),(0,s.jsx)(m.Z,{fontSize:14,fontWeight:500,children:"Invite via link"})]}),(0,s.jsx)(x.Z,{fullWidth:!0,value:en?U?"Failed to generate invite link":"Generating invite link...":Y,placeholder:U?"Failed to generate invite link":"Generating invite link...",onClick:ec,InputProps:{readOnly:!0,endAdornment:(0,s.jsx)(o.Z,{onClick:e=>{e.stopPropagation(),ec()},disabled:!Y||en||U,children:en&&!U?(0,s.jsx)(u.Z,{size:16}):(0,s.jsx)(v.Z,{icon:"mdi:content-copy"})})},sx:{bgcolor:"#202020",borderRadius:1,cursor:Y&&!en?"pointer":"default","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"transparent"},"&:hover fieldset":{borderColor:Y&&!en?"rgba(255, 255, 255, 0.23)":"transparent"}},"& .MuiInputBase-input":{cursor:Y&&!en?"pointer":"default",color:"#868686",fontSize:"14px"}}}),U?(0,s.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",gap:1,p:1.5,bgcolor:"rgba(255, 76, 76, 0.08)",borderRadius:1,border:"1px solid rgba(255, 76, 76, 0.2)"},children:[(0,s.jsx)(v.Z,{icon:"mdi:alert-circle-outline",sx:{color:"#FF4E4E",fontSize:18,flexShrink:0}}),(0,s.jsx)(m.Z,{fontSize:12,color:"#FF4E4E",fontWeight:500,children:K})]}):null,(0,s.jsx)(m.Z,{fontSize:12,color:"#868686",fontWeight:500,children:"Anyone with this link can claim a seat until your available seats are filled."})]})]})})]})}}}]);