"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1284],{7315:function(e,t,n){n.d(t,{R9:function(){return c},bm:function(){return d},lm:function(){return h},sI:function(){return s},yq:function(){return a}});var i=n(21617),r=n(28337);let l=async e=>(await r.ZP.post("/create/batch_generation",e)).data,s=(0,r.py)(l,{refetchKeysOnSuccess:["useQueryBulkGenerations"]}),o=async e=>(await r.ZP.post("/create/delete_scheduled",{sid:e})).data,a=(0,r.py)(o,{refetchKeysOnSuccess:["useQueryBulkGenerations"]}),c=e=>{let t=async t=>{let{pageParam:n}=t;return(await r.ZP.get(`/history/batch_generations?user_id=${e||""}&nextCursor=${n||""}`)).data||[]},{data:n,...l}=(0,i.N)(["useQueryBulkGenerations",e],t,{getNextPageParam:e=>e.nextCursor||null,refetchInterval:e=>!!((null==e?void 0:e.pages.flatMap(e=>e.items))||[]).reduce((e,t)=>e||!t.stopped,!1)&&2e3});return{data:(null==n?void 0:n.pages.flatMap(e=>e.items))||[],...l}},d=e=>{let t=async t=>{let{pageParam:n}=t;return(await r.ZP.get(`/history/query_scheduled_result?schedule_id=${e.id}&nextCursor=${n||""}`)).data||[]},{data:n,...l}=(0,i.N)(["useQueryBulkGenerationsHistory",e.id],t,{getNextPageParam:e=>e.nextCursor||null,refetchInterval:t=>!e.stopped&&2e3});return{data:(null==n?void 0:n.pages.flatMap(e=>e.items))||[],...l}},u=async e=>(await r.ZP.get(`/history/query_scheduled_all_urls?schedule_id=${e}`)).data||[],h=(0,r.py)(u)},9026:function(e,t,n){n.d(t,{Z:function(){return u}});var i=n(52676),r=n(75271),l=n(65893),s=n(44754),o=n(62935),a=n(19242),c=n(51395),d=n(50235);function u(e){let{data:t,itemKey:n,isMobile:u,masonry:h,gutter:x,row:p,isLoading:f,noDataDescription:g="",emptySx:m,noDataSx:j,columns:w,renderItem:b,fetchMore:Z}=e,y=(0,r.useRef)(null),{ref:v,inView:C}=(0,a.YD)();(0,r.useEffect)(()=>{if(C&&Z){let e=setTimeout(()=>{Z()},200);return()=>clearTimeout(e)}},[Z,C]);let k=(e,t)=>{let n=t(w??e);return h?(0,i.jsx)(c.Z,{columnsCount:w??e,gutter:x,children:n}):(0,i.jsx)(l.Z,{sx:{display:"grid",gridTemplateColumns:`repeat(${w??e}, 1fr)`,gridGap:x,width:"100%"},children:n})},_=(e,t)=>(0,i.jsx)(l.Z,{children:b(e,t)},n?(null==e?void 0:e[n])??t:t),z=e=>(p?t.slice(0,p*e):t).map((e,t)=>_(e,t));return(0,i.jsxs)(l.Z,{ref:y,sx:{height:"100%",overflow:"auto",width:"100%"},children:[(0,i.jsx)(d.P,{isMobile:u,children:e=>k(e,z)}),f?(0,i.jsxs)(l.Z,{sx:{minHeight:200,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,i.jsx)(s.Z,{}),(0,i.jsx)(o.Z,{variant:"subtitle1",children:"Loading..."})]}):null,Z?(0,i.jsx)(l.Z,{ref:v,sx:{width:"100%",height:500}}):null]})}},50235:function(e,t,n){n.d(t,{P:function(){return s}});var i=n(52676),r=n(75271),l=n(65893);let s=e=>{let{content:t,isMobile:n,setIsMobile:s,children:o,round:a="round",min:c=2,max:d=5,elementMinWidth:u=250,sx:h}=e,x=(0,r.useRef)(null),[p,f]=(0,r.useState)(n?c:d),g=(0,r.useCallback)(()=>{var e;let t=null===(e=x.current)||void 0===e?void 0:e.clientWidth;if(t){let e=Math[a]((t-100)/u);e<=1?f(c):f(Math.min(e,d)),null==s||s()}},[u,d,c,a,s]),m=o??t;return(0,r.useEffect)(()=>{let e=new ResizeObserver(()=>{g()});return e.observe(x.current),()=>{e.disconnect()}},[g]),(0,i.jsx)(l.Z,{ref:x,sx:h,children:null==m?void 0:m(p)})}},85315:function(e,t,n){n.d(t,{Um:function(){return l},dY:function(){return i},gb:function(){return r},vL:function(){return s}});let i="rgb(84, 84, 84)",r="#292929",l="black",s="create-generation-histories-modal-root"},61284:function(e,t,n){n.d(t,{G:function(){return E}});var i=n(52676),r=n(75271),l=n(40201),s=(0,l.Z)((0,i.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),o=(0,l.Z)([(0,i.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,i.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),a=n(35019),c=n(65893),d=n(65089),u=n(62935),h=n(9026),x=n(43733),p=n(58684),f=n(48945),g=n(71137),m=n(75616),j=n(68836),w=n.n(j),b=n(16483),Z=n.n(b),y=n(8765),v=n(10986),C=n(89717),k=n(85315),_=n(61271),z=n(57598),I=n(355);let S=(0,r.memo)(I.default),M=e=>{let{scheduled:t,...n}=e,{destroyModalsByRootId:l}=(0,y.dd)({disableAutoDestroy:!0}),s=(0,r.useMemo)(()=>({schedule_id:t.id}),[t.id]),o=(0,r.useCallback)(()=>{l(k.vL)},[l]);return(0,i.jsx)(_.Z,{...n,"aria-describedby":"ViewScheduledAllResult","aria-labelledby":"ViewScheduledAllResult",fullWidth:!0,fullScreen:!1,maxWidth:"lg",children:(0,i.jsx)(z.Z,{dividers:!0,children:(0,i.jsx)(c.Z,{sx:{height:"1200px"},children:(0,i.jsx)(S,{userId:t.user_id,filter:s,onClose:o,sign:"bulk"})})})})};var W=n(55309),D=n(7315),$=n(42232),P=n(20261);let R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e.length>t?`${e.slice(0,t)}...`:e},G=(0,r.memo)(function(e){let t=(0,C.aT)(),{scheduled:n,columns:l,isMobile:s,showUserId:o,onClickUser:c}=e,{showModal:d}=(0,y.dd)({disableAutoDestroy:!0}),{enqueueSnackbar:x}=(0,v.Ds)(),{data:j,isSuccess:b}=(0,D.bm)(n),[_]=(0,D.lm)(),[z,I]=(0,D.yq)(),S=(0,m.NL)(),G=(0,r.useCallback)(()=>{S.refetchQueries(["useGenerationHistories",n.user_id,{schedule_id:n.id}]),d(M,{scheduled:n},{rootId:k.vL})},[S,n,d]),A=async()=>{t.confirm({title:"Delete Scheduled Task",content:"Are you sure you want to delete this scheduled task? This action cannot be undone and will result in the deletion of all associated images.",iconType:"warning",async onConfirm(){try{await z(n.id)}catch(e){w().isAxiosError(e)||x("Delete failed",{variant:"error"})}},onCancel(){}})},[E,V]=(0,r.useState)(!1),H=async()=>{try{V(!0);let e=await _(n.id);await (0,P.BY)(e)}catch(e){w().isAxiosError(e)||x("Download failed",{variant:"error"})}finally{V(!1)}},L=n.created_at,N=1e3*L._seconds+Math.floor(L._nanoseconds/1e6),T=Z()(N).local().format("MMM D YYYY HH:mm"),Y=(0,r.useMemo)(()=>{let e=n.progress.success+n.progress.error;return n.scheduled?"pending":n.stopped&&e>=n.progress.total?"completed":n.scheduled||!(e<n.progress.total)||n.stopped?"completed":"running"},[n]),B={pending:{chip:(0,i.jsx)(f.Z,{icon:(0,i.jsx)($.Z,{icon:"line-md:loading-twotone-loop",width:20,height:20}),label:(0,i.jsx)(u.Z,{fontWeight:500,fontSize:"12px",children:"Pending..."}),component:"span",sx:{color:"rgba(255, 255, 255, 0.5)"},size:"small"}),actions:null},running:{chip:(0,i.jsx)(f.Z,{icon:(0,i.jsx)($.Z,{icon:"line-md:loading-twotone-loop",width:20,height:20}),label:(0,i.jsxs)(u.Z,{fontWeight:500,fontSize:"12px",children:["Running... ","it could take 20 mins to 2 hrs"]}),component:"span",sx:{backgroundColor:"rgba(22, 216, 102, 0.2)",color:"#16D866"},size:"small"}),actions:(0,i.jsxs)(a.Z,{direction:s?"column":"row",spacing:1,alignItems:"center",width:s?"100%":"auto",children:[(0,i.jsx)(p.Z,{variant:"contained",onClick:H,loading:E,size:"small",fullWidth:s,sx:{color:"white",width:s?"100%":"auto",backgroundColor:`${W.tE} !important`},children:"Download Completed Image"}),(0,i.jsx)(g.Z,{size:"small",fullWidth:s,variant:"outlined",onClick:G,children:"View"})]})},stopped:{chip:null,actions:(0,i.jsxs)(a.Z,{spacing:1,direction:s?"column":"row",width:s?"100%":"auto",children:[(0,i.jsx)(p.Z,{variant:"contained",onClick:H,loading:E,size:"small",fullWidth:s,sx:{color:"white",backgroundColor:`${W.tE} !important`},children:"Download Completed Image"}),(0,i.jsx)(p.Z,{size:"small",variant:"outlined",onClick:G,fullWidth:s,loading:I,children:"View"})]})},completed:{chip:null,actions:(0,i.jsxs)(a.Z,{direction:s?"column":"row",spacing:1,justifyContent:"center",alignItems:"center",width:s?"100%":"auto",children:[(0,i.jsx)(p.Z,{variant:"contained",onClick:H,loading:E,size:"small",fullWidth:s,sx:{color:"white",backgroundColor:`${W.tE} !important`},children:"Download All Image"}),(0,i.jsx)(g.Z,{size:"small",variant:"outlined",onClick:G,fullWidth:s,children:"View"}),(0,i.jsx)(p.Z,{size:"small",onClick:A,fullWidth:s,loading:I,color:"error",children:"Delete"})]})}},Q=n.progress.success||n.progress.error?`${n.progress.success} / ${n.progress.total} completed`:`total ${n.progress.total} images`,q=n.progress.error?`, ${n.progress.error} failed`:"",O=s?B[Y].chip:null;return(0,i.jsxs)(a.Z,{direction:"column",spacing:1,width:"100%",p:1,sx:{background:"black",borderRadius:1},children:[(0,i.jsxs)(a.Z,{direction:s?"column":"row",alignItems:"center",justifyContent:"space-between",spacing:2,children:[(0,i.jsxs)(a.Z,{children:[o?(0,i.jsx)(u.Z,{fontWeight:700,fontSize:s?"16px":"18px",onClick:()=>{null==c||c(n.user_id)},children:n.user_id}):null,(0,i.jsxs)(u.Z,{fontWeight:s?500:700,fontSize:s?"14px":"16px",component:"div",children:[(0,i.jsxs)("span",{children:["Scheduled on ",T," ("]}),n.file_name?(0,i.jsxs)("span",{children:["File name ",R(n.file_name),", "]}):null,(0,i.jsx)("span",{children:Q}),(0,i.jsx)("span",{children:q}),(0,i.jsx)("span",{children:") "}),O]})]}),(0,i.jsx)(a.Z,{width:s?"100%":"auto",direction:"row",alignItems:"center",spacing:1,children:(0,i.jsxs)(i.Fragment,{children:[s?null:B[Y].chip,B[Y].actions]})})]}),b&&j.length>0?(0,i.jsx)(a.Z,{sx:{position:"relative",background:"black",borderRadius:1,overflow:"hidden",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",borderRadius:"inherit",zIndex:1,transition:"background-color 0.3s ease, transform 0.3s ease"},"&:hover::after":{content:'"View"',position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",fontSize:"18px",fontWeight:"bold",zIndex:2,opacity:1,transition:"opacity 0.3s ease, transform 0.3s ease"},"&::after":{content:'"View"',position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -40%)",color:"white",fontSize:"18px",fontWeight:"bold",zIndex:2,opacity:0,transition:"opacity 0.3s ease, transform 0.3s ease"},"&:active":{transform:"scale(0.98)",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.3)"},cursor:"pointer"},onClick:G,children:(0,i.jsx)(h.Z,{isMobile:s,data:j,row:2,gutter:"8px",columns:l,renderItem:e=>(0,i.jsx)("img",{src:e.url,alt:e.url,style:{borderRadius:"8px"}})})}):null]})});var A=n(80924);let E=e=>{let{user_id:t,showUserId:n=!1,onClickUser:l}=e,{isMobile:p,isDesktop:f}=(0,A.j)(),[g,m]=(0,r.useState)(p?4:8),{data:j,hasNextPage:w,fetchNextPage:b,isFetchingNextPage:Z}=(0,D.R9)(t);return(0,i.jsxs)(a.Z,{direction:"column",position:"relative",height:"100%",children:[(0,i.jsxs)(a.Z,{direction:"row",spacing:2,flexGrow:2,mt:2,p:1,justifyContent:f?"flex-end":"space-between",children:[(0,i.jsx)(a.Z,{direction:f?"row":"column",flexGrow:3,children:(0,i.jsx)(x.Z,{})}),f?(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"end",flexGrow:1,my:1},children:[(0,i.jsx)(s,{sx:{mr:2}}),(0,i.jsx)(d.ZP,{min:2,max:p?4:12,size:"small",value:g,onChange:(e,t)=>{m(t)}}),(0,i.jsx)(o,{sx:{ml:2}})]}):null]}),(0,i.jsx)(a.Z,{direction:"column",spacing:2,p:1,width:"100%",overflow:"hidden",height:"100vh",children:(0,i.jsxs)(c.Z,{width:"100%",height:"100%",overflow:"auto",children:[(null==j?void 0:j.length)===0&&!Z&&(0,i.jsx)(u.Z,{sx:{color:"text.secondary",textAlign:"center",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:"No scheduled tasks"}),(0,i.jsx)(h.Z,{data:j,columns:1,gutter:"16px",isLoading:Z,fetchMore:()=>{!Z&&w&&b()},renderItem:e=>(0,i.jsx)(G,{scheduled:e,isMobile:p,columns:g,showUserId:n,onClickUser:l},e.id)})]})})]})}}}]);