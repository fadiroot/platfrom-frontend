"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2721],{92721:function(e,i,n){n.d(i,{Z:function(){return H}});var o=n(52676),r=n(75271),t=n(86694),s=n.n(t),l=n(46974),a=n(19082),d=n(30861),c=n(35019),x=n(66686),h=n(71137),p=n(52889),u=n(65893),f=n(82338),g=n(63888);let b=(0,n(56371).O4)("enterprise-mode",!1);var j=n(62935),w=n(44754),Z=n(17831),k=n(24337),m=n(2656),v=n(55309),y=n(22289),F=n(66603);let C=[{key:"sign-in",label:"Sign In",linkTo:"/workflows/signin"},{key:"about",withDivider:!0,label:"About OpenArt",linkTo:"/workflows/about"}],S=[{key:"profile",label:"My Workflows",linkTo:e=>`/workflows/@${e}?tab=workflows`},{key:"post",withDivider:!0,label:(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,o.jsx)(j.Z,{children:"Post"}),(0,o.jsx)(u.Z,{sx:{fontSize:"11px",color:v.MK,backgroundColor:"rgba(63, 221, 120, 0.2)",padding:"2px 4px",borderRadius:"4px"},children:"Main site"})]}),linkTo:"/post",target:"_blank"},{key:"settings",label:"Settings",linkTo:"/workflows/settings"},{key:"about",label:"About OpenArt",linkTo:"/workflows/about"}];function I(e){let{}=e,{status:i}=(0,g.useSession)(),{data:n,isLoading:t}=(0,y.$_)(),{name:s,username:l,avatar:a,is_workflow_dev:d}=n||{},h="authenticated"===i?S:C;d&&(h=h.filter(e=>"string"!=typeof e.linkTo||!e.linkTo.startsWith("/photobooth")));let[p,u]=(0,r.useState)(null),f=()=>{u(null)};return"authenticated"===i&&t?(0,o.jsx)(w.Z,{sx:{left:"40px",top:"40px",color:"#ccc"}}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.Z,{"aria-describedby":"profile-popover",variant:"contained",sx:{p:0},onClick:e=>{u(e.currentTarget)},children:(0,o.jsx)(Z.Z,{alt:s,src:"authenticated"===i?a:""})}),(0,o.jsx)(F.Z,{id:"profile-popover",open:!!p,anchorEl:p,onClose:f,children:(0,o.jsx)(c.Z,{sx:{p:1},children:h?h.map(e=>{let i="function"==typeof e.linkTo?e.linkTo(l):e.linkTo;return(0,o.jsxs)(r.Fragment,{children:[e.withDivider?(0,o.jsx)(k.Z,{sx:{borderStyle:"dashed"}}):null,(0,o.jsx)(m.Z,{onClick:()=>{var i;null===(i=e.onClick)||void 0===i||i.call(e),f()},component:"a",href:i,...e.newTab&&{target:"_blank",rel:"noopener noreferrer"},target:e.target??"",children:e.label})]},e.key)}):null})})]})}var T=n(34927),D=n(48547),_=n(27721),E=n(6439),L=n(79017),M=n(42232),W=n(52131),A=e=>{let{sx:i}=e,{open:n,openSessionManagerModal:r,closeSessionManager:t,activeSessions:s}=(0,W.b)();return(0,L.Z)(n),(0,o.jsx)(u.Z,{sx:{position:"fixed",transition:"all 0.3s ease-in-out",transform:n?"translateX(0)":"translateX(100%)",...n?{bottom:0,left:0}:{bottom:0,right:200},margin:"20px",zIndex:999999,...i},children:(0,o.jsx)(E.Z,{variant:"extended",onClick:()=>{n?t():r()},sx:{borderRadius:"10px",boxShadow:"none"},children:n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(M.Z,{icon:"ph:x-square-bold",width:20,height:20}),(0,o.jsx)(j.Z,{variant:"body2",fontWeight:500,children:"Close"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(M.Z,{icon:"eos-icons:cluster-management-outlined",width:20,height:20}),(0,o.jsxs)(j.Z,{variant:"body2",fontWeight:500,children:["Session Manager (",s.length,")"]})]})})})},G=n(58684),z=n(70565),R=n(98866),q=e=>{let{}=e,{open:i,loadedSessions:n,activeSessions:t,isFetchSessionListLoading:s,isStoppingCloudWorkflow:l,closeSessionManager:a,displaySession:d,refreshSessionList:h,setLoadedSessionById:p,stopCloudWorkflowSession:f,setDisplayActiveSession:g,addLoadingSession:b}=(0,W.b)(),Z=d();return(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,o.jsx)(R.ZP,{sx:{flexShrink:0,"& .MuiDrawer-paper":{width:"100%",boxSizing:"border-box"},position:"relative","& .MuiPaper-root.MuiPaper-elevation.MuiDrawer-paper.MuiDrawer-paperAnchorLeft":{borderRight:"none",top:"unset"}},variant:"persistent",anchor:"right",open:i,children:(0,o.jsxs)(c.Z,{direction:"row",spacing:2,sx:{p:2,width:"100%",height:"100%",flexGrow:1},children:[(0,o.jsxs)(c.Z,{direction:"column",spacing:2,sx:{flexGrow:0,flexShrink:0,width:"220px"},children:[(0,o.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",children:[(0,o.jsx)(j.Z,{variant:"h6",children:"Active Sessions"}),(0,o.jsx)(z.Z,{title:"Refresh session list",placement:"bottom",children:(0,o.jsx)(x.Z,{color:"primary",size:"small",disabled:s,onClick:()=>h(!0),children:s?(0,o.jsx)(M.Z,{icon:"line-md:loading-twotone-loop",width:20,height:20}):(0,o.jsx)(M.Z,{icon:"ph:arrows-counter-clockwise-bold",width:20,height:20})})})]}),(0,o.jsxs)(c.Z,{direction:"column",spacing:1,children:[t.map(e=>{let{id:i,gpu_type:r,session_created_at:t,workflow_name:s,url:a,status:d}=e,x="ready"===d,h=(null==Z?void 0:Z.session_id)===i,p=Math.floor((new Date().getTime()-new Date((null==t?void 0:t._seconds)*1e3).getTime())/1e3/60);return(0,o.jsxs)(u.Z,{sx:{backgroundColor:h?"#FFFFFF11":"transparent",cursor:"pointer","&:hover":{backgroundColor:"#FFFFFF11"},padding:"8px",borderLeft:h?"3px solid #4cf36b":"3px solid #4cf36baa",...!x&&{borderLeft:"3px solid #f49d4c"}},onClick:()=>{let e=n.find(e=>e.session_id===i);e?g(e.session_id):(b({session_id:i,url:a,loading:!0}),g(i))},children:[(0,o.jsxs)(c.Z,{direction:"column",spacing:1,children:[(0,o.jsx)(j.Z,{variant:"caption",fontWeight:500,sx:{color:h?"#4cf36b":"#4cf36baa",...!x&&{color:"#f49d4c"}},children:s}),(0,o.jsx)(c.Z,{direction:"row",spacing:1,children:(0,o.jsxs)(j.Z,{variant:"caption",sx:{color:"#FFFFFFaa"},children:["GPU: ",r]})}),(0,o.jsx)(c.Z,{direction:"row",spacing:1,children:(0,o.jsxs)(j.Z,{variant:"caption",sx:{color:"#FFFFFFaa"},children:["Duration: ",p," minutes"]})})]}),h?(0,o.jsx)(c.Z,{direction:"row",spacing:1,sx:{mt:1},children:(0,o.jsx)(G.Z,{loading:l,size:"small",variant:"outlined",startIcon:(0,o.jsx)(M.Z,{icon:"ic:round-stop-circle",width:15,height:15}),sx:{textTransform:"none",color:"white",borderRadius:"3px"},onClick:()=>{f(i)},children:"Stop"})}):null]},`session-${i}`)}),(!t||0===t.length)&&(0,o.jsx)(j.Z,{variant:"body2",children:"No active sessions."})]})]}),(0,o.jsx)(k.Z,{orientation:"vertical",flexItem:!0}),(0,o.jsx)(c.Z,{direction:"column",sx:{flexGrow:1},children:(0,o.jsx)(c.Z,{direction:"row",sx:{flexGrow:1,height:"calc(100% - 40px)",position:"relative"},children:n.map(e=>{let{session_id:i,url:n,loading:r}=e,t=(null==Z?void 0:Z.session_id)===i;return(0,o.jsxs)(u.Z,{sx:{width:"100%",height:"100%",backgroundColor:"#000000aa",display:t?"block":"none"},children:[(0,o.jsx)(u.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:t&&r?"flex":"none",backgroundColor:"#000000aa",zIndex:1e3,alignItems:"center",justifyContent:"center"},children:(0,o.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,o.jsx)(w.Z,{}),(0,o.jsx)(j.Z,{variant:"subtitle1",children:"Loading..."})]})}),(0,o.jsx)("iframe",{onLoad:()=>{p(i)},src:n,style:{width:"100%",height:"100%",border:"3px solid #FFFFFF33"}},`iframe-${i}`)]},i)})})})]})})},O=n(44941),P=n(3263),B=n(77985),N=n(77530),Y=n(57914),X=n(45137),$=n(31289);let U=s()(()=>n.e(7286).then(n.bind(n,17286)),{loadableGenerated:{webpack:()=>[17286]},ssr:!0}),K=new Set([]),V=new Set([]);function H(e){let{children:i,fullWidth:n,ssrPathname:t,isSsrMobile:s,isRunnableTester:j,isAdmin:w,isWorkflowAdmin:Z}=e,k=(0,a.Dv)(b),{status:m}=(0,g.useSession)(),v="authenticated"===m,{query:F}=(0,l.useRouter)()||{},{data:C}=(0,y.$_)(),{id:S,cloud_run_beta_access:E}=C||{},L=(0,O.Z)("up","md"),[W,G]=(0,r.useState)(s);(0,r.useEffect)(()=>{G(!L)},[L]);let[z,R]=(0,r.useState)(!s&&!V.has(t)),H=(0,a.Dv)(P.q),J=K.has(t)||W;(0,r.useEffect)(()=>{L?V.has(t)?R(!1):R(!0):R(!1)},[L,t]),(0,r.useEffect)(()=>{"loading"!==m&&(v&&S?X.S1({userId:S}):X.S1({}))},[m,S]);let Q=["dOp6BlUh0AgkVu3ILV59","zfPPYiCGyEqGLIxsX8LY","YipQq2NWRrv4MdniAI9x","8aHq6WDmAeNWoKdwBNUI","YRBKIAJlcqE2T8djjnyB"].includes(S),ee=(0,$.DB)({pathname:"/workflows",queryParams:F});return(0,o.jsx)(c.Z,{direction:"column",children:(0,o.jsxs)(u.Z,{sx:{display:"flex",position:"relative"},children:[(0,o.jsx)(U,{isMobile:W,open:null!==H?H:z,setOpen:R,logo:(0,o.jsx)(T.Z,{sx:{...k&&{opacity:0,pointerEvents:"none"}},to:ee})}),!W&&v&&(E||j||Z||w)?(0,o.jsx)(A,{}):null,!W&&(0,o.jsx)(q,{}),(0,o.jsx)(N.Z,{isSidebarOpen:z,isMobile:W,children:(0,o.jsx)(B.Z,{hidden:J,children:(0,o.jsxs)(Y.Z,{isSsrMobile:s,children:[(0,o.jsxs)(u.Z,{sx:{display:"flex",width:"100%",backgroundColor:W&&"#000",justifyContent:"space-between",top:W&&0,left:W&&0,position:W&&"fixed",padding:W&&"16px",zIndex:3},children:[(0,o.jsxs)(c.Z,{direction:"row",spacing:z?0:2,children:[z?null:(0,o.jsxs)(c.Z,{direction:"row",hidden:!!z,sx:{visibility:z?"hidden":"block"},children:[(0,o.jsx)(x.Z,{color:"inherit","aria-label":"open drawer",onClick:()=>{R(!0)},edge:"start",children:(0,o.jsx)(d.Z,{})}),Q?(0,o.jsx)(u.Z,{flexShrink:0,flexGrow:{xs:1,sm:0},display:"flex",alignItems:"center",sx:{...k&&{opacity:0,pointerEvents:"none"}},children:(0,o.jsx)(_.Z,{sx:{width:"135px",height:"50px"}})}):(0,o.jsx)(T.Z,{to:ee})]}),W?null:(0,o.jsx)(h.Z,{LinkComponent:p.Z,href:"/",target:"_blank",variant:"outlined",size:"small",sx:{fontWeight:700,borderRadius:"10px",border:"2px solid #343839",background:"#141718","&:hover":{borderRadius:"10px",border:"2px solid #343839",background:"#141718"}},endIcon:(0,o.jsx)(M.Z,{icon:"ph:arrow-right-bold",sx:{fontWeight:700}}),children:"Go to OpenArt main site"})]}),(0,o.jsxs)(c.Z,{direction:"row",spacing:W?0:1,alignItems:"center",children:[(0,o.jsx)(x.Z,{variant:"outlined",href:"https://discord.gg/XYjZZT3mXW",target:"_blank",rel:"noreferrer noopener",sx:{backgroundColor:"text.primary","&:hover":{backgroundColor:"text.secondary"}},size:"small","aria-label":"Discord",children:(0,o.jsx)(M.Z,{icon:"ic:round-discord",color:"#5865F2"})}),W?null:(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(h.Z,{LinkComponent:p.Z,href:"/workflows/publish",variant:"contained",sx:{backgroundColor:"#7C3CFF",color:"#fff",fontWeight:700,"&:hover":{backgroundColor:"#7C3CFF"}},startIcon:(0,o.jsx)(M.Z,{icon:"ph:upload-simple-bold"}),children:"Upload workflow"})}),(0,o.jsx)(D.Y,{}),(0,o.jsx)(I,{})]})]}),(0,o.jsx)(f.Z,{component:"main",maxWidth:n?void 0:"xl",sx:{marginTop:W&&8},disableGutters:!0,children:i})]})})})]})})}}}]);